<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live CCR & PFE Calculator — ISDA Netting</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="assets/style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { background:#000; color:#fff; font-family:Arial,sans-serif; padding:20px; }
  h1 { color:#f5a623; text-align:center; font-size:2.2em; }
  .box { background:#1a1a1a; padding:20px; border-radius:8px; margin:20px 0; border:2px solid #f5a623; }
  input, select, button { padding:10px; margin:5px; border-radius:4px; border:1px solid #f5a623; background:#000; color:#fff; font-size:1em; }
  button { background:#f5a623; color:#000; font-weight:bold; cursor:pointer; }
  button:hover { background:#d9911e; }
  table { width:100%; border-collapse:collapse; margin:15px 0; }
  th, td { border:1px solid #fff; padding:10px; text-align:center; }
  th { background:#f5a623; color:#000; }
</style>
</head>
<body>
<div class="container">
  <h1>Live Counterparty Credit Risk Calculator</h1>
  <p style="text-align:center; color:#aaa;">ISDA netting • Real-time PFE/EE • Limits • Stress • Wrong-Way Risk</p>

  <div class="box">
    <input type="text" id="cp" placeholder="Counterparty" value="Hedge Fund Alpha">
    <select id="rating"><option>A</option><option>BBB</option><option>BB</option><option selected>B</option></select>
    <select id="sector"><option>Banks</option><option selected>Hedge Funds</option><option>Private Equity</option><option>Corporates</option></select>
    <select id="csa"><option selected>Yes</option><option>No</option></select>
  </div>

  <table id="t">
    <thead><tr><th>Product</th><th>Notional €</th><th>Maturity yrs</th><th>Strike/Rate</th><th></th></tr></thead>
    <tbody>
      <tr>
        <td>FX Forward EURUSD</td>
        <td><input type="number" value="3000000"></td>
        <td><input type="number" value="2" step="0.25"></td>
        <td><input type="number" value="1.12" step="0.01"></td>
        <td><button onclick="this.parentElement.parentElement.remove()">Remove</button></td>
      </tr>
    </tbody>
  </table>
  <button onclick="a()">+ Add Trade</button>
  <button onclick="c()">Calculate Now</button>

  <div id="r" class="box" style="display:none">
    <h2>Results</h2>
    <p><strong>Peak PFE 95%:</strong> <span id="pfe" style="color:#ff4444;font-size:1.3em"></span></p>
    <p><strong>Expected Exposure:</strong> <span id="ee"></span> | <strong>Limit Breach:</strong> <span id="br"></span></p>
    <p><strong>EWI / Stress:</strong> <span id="ewi"></span></p>
    <canvas id="ch"></canvas>
  </div>

  <p style="text-align:center; margin-top:40px;">
    <a href="demo.html" style="color:#f5a623; font-size:1.1em;">View Full Python Methodology →</a>
  </p>

  <hr style="border:1px solid #f5a623; margin:60px 0">
  <footer style="text-align:center; color:#aaa;">
    Built by <strong>Andrey</strong> • 
    <a href="https://www.linkedin.com/in/and86rey/" target="_blank" style="color:#f5a623; text-decoration:none; font-weight:bold;">LinkedIn</a> • 
    Open-source MIT
  </footer>
</div>

<script>
function a(){document.querySelector("#t tbody").insertRow().innerHTML=`<tr><td>FX Forward EURUSD</td><td><input type="number" value="1000000"></td><td><input type="number" value="1" step="0.25"></td><td><input type="number" value="1.08" step="0.01"></td><td><button onclick="this.parentElement.parentElement.remove()">Remove</button></td></tr>`;}
function simulate(trades){
  const paths=2000, steps=60; let time=[],ee=[],pfe=[];
  for(let s=0;s<=steps;s++){
    let t=s/steps*5, pos=[];
    trades.forEach(tr=> {
      let rem=tr.mat-tr.t; if(rem<=0)return;
      let shock = 0.12 * Math.sqrt(rem) * (Math.random()*2-1)*2.8;
      let mtm = tr.n * (tr.s * Math.exp(shock) - tr.s);
      if(mtm>0) pos.push(mtm);
    });
    let samples=[]; for(let i=0;i<paths;i++)samples.push(pos.reduce((a,b)=>a+b,0)*(0.85+Math.random()*0.3));
    time.push(t); ee.push(samples.reduce((a,b)=>a+b,0)/paths/1e6);
    samples.sort((a,b)=>a-b); pfe.push(samples[Math.floor(0.95*paths)]/1e6);
  }
  return {time,ee,pfe,peak:Math.max(...pfe),eePeak:Math.max(...ee)};
}
function c(){
  let trades=[]; document.querySelectorAll("#t tbody tr").forEach(r=>{
    let i=r.querySelectorAll("input"); trades.push({n:+i[0].value, mat:+i[1].value, s:+i[2].value, t:0});
  });
  const res=simulate(trades);
  const lim = {Banks:1.5, "Hedge Funds":0.8, "Private Equity":0.6, Corporates:1}[document.getElementById("sector").value];
  const breach=res.peak>lim;
  const wwr = document.getElementById("sector").value==="Private Equity"?1.8:document.getElementById("sector").value==="Hedge Funds"?1.5:1;
  document.getElementById("pfe").textContent=`€${res.peak.toFixed(2)}m`;
  document.getElementById("ee").textContent=`€${res.eePeak.toFixed(2)}m`;
  document.getElementById("br").textContent=breach?"BREACH":"OK";
  document.getElementById("br").style.color=breach?"#ff4444":"#44ff44";
  document.getElementById("ewi").textContent = document.getElementById("rating").value<="BB"?"High Risk Rating + ":"" + (res.peak>lim*1.4?"Severe Spike":"Clean");
  document.getElementById("r").style.display="block";
  const ctx=document.getElementById("ch").getContext("2d");
  if(window.ch)window.ch.destroy();
  window.ch=new Chart(ctx,{type:"line",data:{labels:res.time,datasets:[
    {label:"EE (€m)",data:res.ee,borderColor:"#44ff44"},
    {label:"PFE 95% (€m)",data:res.pfe,borderColor:"#ff4444"},
    {label:"Stressed + WWR (€m)",data:res.pfe.map(x=>x*wwr*1.6),borderColor:"#ff8800",borderDash:[6,6]}
  ]},options:{responsive:true}});
}
</script>
</body>
</html>
